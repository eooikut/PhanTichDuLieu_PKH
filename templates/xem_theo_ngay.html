{% extends "base.html" %}

{% block title %}Xem trạng thái theo ngày{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="card shadow-sm border-0">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h2 class="mb-0"><i class="fas fa-calendar-alt me-2"></i>Xem trạng thái sản xuất theo ngày</h2>
        </div>
        <div class="card-body">
            {% if not has_data %}
                <div class="alert alert-warning d-flex align-items-center shadow-sm" role="alert">
                    <i class="fas fa-exclamation-triangle me-2"></i>
                    <div>
                        Chưa có dữ liệu nào được tải lên. 
                        Vui lòng <a href="{{ url_for('upload_files') }}" class="alert-link">tải lên bộ dữ liệu LSX tại đây</a>.
                    </div>
                </div>
            {% else %}
                <div class="d-flex justify-content-between align-items-center mb-4">
    <form method="GET" action="{{ url_for('xem_theo_ngay') }}" class="d-flex align-items-center gap-3">

        <!-- Dropdown chọn LSX -->
        <label for="lsx_id" class="form-label fw-bold mb-0">Chọn LSX:</label>
        <select id="lsx_id" name="lsx_id" class="form-select w-auto">
            {% for lsx in lsx_list %}
                <option value="{{ lsx.id }}" {% if selected_lsx == lsx.id %}selected{% endif %}>
                    {{ lsx.name }}
                </option>
            {% endfor %}
        </select>

        <!-- Input chọn ngày -->
        <label for="date" class="form-label fw-bold mb-0">Chọn ngày:</label>
        <input type="date" id="date" name="date" value="{{ selected_date }}"
               class="form-control w-auto" required>

        <button type="submit" class="btn btn-success">
            <i class="fas fa-eye me-2"></i>Xem
        </button>
    </form>

    <a href="{{ url_for('tien_do_order') }}" class="btn btn-outline-primary">
        <i class="fas fa-chart-line me-2"></i>Xem tiến độ tổng Order
    </a>
</div>

                {% if orders %}
                    <div class="table-responsive">
                        <table class="table table-striped table-hover align-middle mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th scope="col">Order</th>
                                    <th scope="col">SL Trung bình/ngày (kg)</th>
                                    <th scope="col">SL Thực tế/ngày (kg)</th>
                                    <th scope="col">Trạng thái</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for order in orders %}
                                <tr>
                                    <td class="fw-bold">{{ order.Order }}</td>
                                    <td>{{ "{:,.0f}".format(order['SL trung bình/ngày']) }}</td>
                                    <td>{{ "{:,.0f}".format(order['Sản lượng thực tế']) }}</td>
                                    <td>
                                        {% if "Thất thoát" in order['Trạng thái'] %}
                                            <span class="badge bg-danger px-3 py-2">{{ order['Trạng thái'] }}</span>
                                        {% elif "Vượt" in order['Trạng thái'] %}
                                            <span class="badge bg-success px-3 py-2">{{ order['Trạng thái'] }}</span>
                                        {% else %}
                                            <span class="badge bg-warning text-dark px-3 py-2">{{ order['Trạng thái'] }}</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>

                    <div class="alert alert-info mt-4 d-flex align-items-center shadow-sm" role="alert">
                        <i class="fas fa-info-circle me-2"></i>
                        <div>
                            <strong>Tổng thất thoát ngày {{ selected_date }}:</strong> 
                            {{ "{:,.0f}".format(total_loss) }} kg
                        </div>
                    </div>
                {% else %}
                    <div class="alert alert-secondary d-flex align-items-center shadow-sm" role="alert">
                        <i class="fas fa-ban me-2"></i>
                        Không có dữ liệu cho ngày {{ selected_date }}
                    </div>
                {% endif %}
            {% endif %}
        </div>
    </div>
</div>

<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
body {
    font-family: 'Segoe UI', Roboto, sans-serif;
    background: #f8f9fa;
    color: #212529;
}

.card {
    border-radius: 0.75rem;
    overflow: hidden;
}

.card-header {
    padding: 1rem 1.5rem;
}

.table {
    border-radius: 0.5rem;
    overflow: hidden;
}

.table th {
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.05em;
    text-align: center;
    vertical-align: middle;
}

.table td {
    vertical-align: middle;
    text-align: center;
    padding: 0.75rem;
}

.table tbody tr:hover {
    background-color: #f1f3f5;
}

.form-control {
    border-radius: 0.375rem;
    padding: 0.5rem;
    max-width: 200px;
}

.btn {
    border-radius: 0.375rem;
    padding: 0.5rem 1.5rem;
}

.btn-success {
    background-color: #28a745;
    border-color: #28a745;
}

.btn-success:hover {
    background-color: #218838;
    border-color: #1e7e34;
}

.btn-outline-primary {
    border-color: #007bff;
    color: #007bff;
}

.btn-outline-primary:hover {
    background-color: #007bff;
    color: #fff;
}

.badge {
    font-size: 0.9rem;
    padding: 0.5rem 1rem;
    border-radius: 0.25rem;
}

.alert {
    border-radius: 0.375rem;
}
</style>
{% endblock %}